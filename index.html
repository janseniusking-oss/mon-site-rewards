<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#111111" />
  <meta name="description" content="REWARD WEB - Gagne des Robux gratuits en regardant des pubs !" />
  <title>REWARD WEB - Gagne Robux Gratuit</title>

  <style>
  /* ================================================
     VARIABLES GLOBALES
  ================================================ */
  :root {
    --bg:     #111111;
    --card:   #1a1a1a;
    --card2:  #222222;
    --border: #2a2a2a;
    --gold:   #ffd700;
    --green:  #2ecc71;
    --red:    #e74c3c;
    --text:   #eeeeee;
    --muted:  #888888;
    --radius: 14px;
  }

  /* ================================================
     RESET
  ================================================ */
  *, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    -webkit-tap-highlight-color: transparent;
  }

  html, body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
    min-height: 100%;
    overflow-x: hidden;
  }

  /* ================================================
     UTILITAIRES
  ================================================ */
  .hidden { display: none !important; }

  .page {
    min-height: 100vh;
    padding: 24px 16px 48px;
    max-width: 480px;
    margin: 0 auto;
  }

  /* ================================================
     BOUTONS
  ================================================ */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    width: 100%;
    padding: 14px 22px;
    border: none;
    border-radius: var(--radius);
    font-family: inherit;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    transition: transform .12s, opacity .15s;
  }
  .btn:active   { transform: scale(.96); }
  .btn:disabled { opacity: .45; cursor: not-allowed; transform: none; }

  .btn-gold  { background: linear-gradient(135deg, #ffd700, #ff9800); color: #111; }
  .btn-green { background: linear-gradient(135deg, #2ecc71, #27ae60); color: #fff; }
  .btn-dark  {
    background: var(--card2);
    color: var(--text);
    border: 1px solid #333;
  }

  /* ================================================
     CARD
  ================================================ */
  .card {
    background: var(--card2);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    padding: 18px;
    margin-bottom: 14px;
  }

  .section-title {
    font-size: 12px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1.2px;
    margin-bottom: 10px;
  }

  /* ================================================
     ANIMATIONS
  ================================================ */
  @keyframes flash-gold {
    0%   { background: rgba(255, 215, 0, .32); border-color: var(--gold); }
    100% { background: var(--card2);           border-color: #333; }
  }
  .flash { animation: flash-gold .7s ease-out; }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50%       { opacity: 0; }
  }
  .blink { animation: blink 1.1s infinite; }

  /* ================================================
     PAGE CONNEXION
  ================================================ */
  #page-login {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
  }

  .logo-text {
    font-size: 46px;
    font-weight: 900;
    letter-spacing: 4px;
    background: linear-gradient(135deg, #ffd700, #ff9800);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 10px;
  }

  .subtitle {
    font-size: 13px;
    color: var(--muted);
    max-width: 300px;
    margin: 0 auto 36px;
    line-height: 1.7;
  }

  .login-providers {
    display: flex;
    gap: 16px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .provider-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    width: 100px;
    padding: 20px 16px;
    background: var(--card2);
    border: 2px solid #333;
    border-radius: 18px;
    color: var(--text);
    font-family: inherit;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: border-color .2s, transform .12s, box-shadow .2s;
  }
  .provider-btn:hover {
    border-color: var(--gold);
    box-shadow: 0 0 20px rgba(255, 215, 0, .2);
    transform: translateY(-3px);
  }
  .provider-btn:active { transform: scale(.93); }
  .provider-btn img {
    width: 40px;
    height: 40px;
    object-fit: contain;
  }

  /* ================================================
     DASHBOARD
  ================================================ */
  .top-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }
  .top-bar h1 {
    font-size: 22px;
    font-weight: 900;
    color: var(--gold);
  }

  /* Compteur gold */
  .gold-counter {
    display: flex;
    align-items: center;
    gap: 14px;
    background: var(--card2);
    border-radius: var(--radius);
    border: 1px solid #333;
    padding: 16px 18px;
    margin-bottom: 14px;
    transition: background .3s, border-color .3s;
  }
  .gold-counter .amount {
    font-size: 38px;
    font-weight: 900;
    color: var(--gold);
  }
  .gold-counter .label {
    font-size: 13px;
    color: var(--muted);
    margin-top: 2px;
  }

  /* Sondage */
  .survey-msg {
    background: rgba(231, 76, 60, .12);
    border: 1px solid var(--red);
    border-radius: var(--radius);
    padding: 12px 16px;
    font-size: 12px;
    font-weight: 700;
    color: var(--red);
    text-align: center;
    line-height: 1.6;
    margin-bottom: 14px;
  }

  /* Grille jeux */
  .games-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  .btn-game {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    padding: 18px 10px;
    background: var(--card2);
    border: 2px solid #333;
    border-radius: var(--radius);
    color: var(--text);
    font-family: inherit;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    transition: border-color .2s, transform .12s;
  }
  .btn-game:hover  { border-color: var(--green); transform: translateY(-2px); }
  .btn-game:active { transform: scale(.95); }
  .btn-game .icon  { font-size: 30px; }

  /* Navigation bas */
  .nav-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 14px;
  }

  /* ================================================
     PAGE JEU
  ================================================ */
  #page-game {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-bottom: 32px;
  }

  #page-game h2 {
    font-size: 22px;
    color: var(--gold);
    margin-bottom: 6px;
  }

  .game-info {
    font-size: 12px;
    color: var(--muted);
    margin-bottom: 12px;
    text-align: center;
  }

  #game-canvas {
    display: block;
    width: 100%;
    max-width: 340px;
    border-radius: 12px;
    border: 2px solid var(--border);
    touch-action: none;
  }

  /* Barre progression gold */
  .gold-timer {
    width: 100%;
    max-width: 340px;
    margin-top: 12px;
    padding: 10px 14px;
    background: var(--card2);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 12px;
    color: var(--muted);
  }
  .gold-timer .timer-track {
    height: 7px;
    background: #333;
    border-radius: 4px;
    overflow: hidden;
    margin-top: 6px;
  }
  .gold-timer .timer-fill {
    height: 100%;
    border-radius: 4px;
    background: linear-gradient(90deg, #2ecc71, #ffd700);
    transition: width 1s linear;
    width: 0%;
  }

  /* Contr√¥les Pong */
  .pong-controls {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 14px;
    width: 100%;
    max-width: 340px;
  }
  .pong-controls button {
    width: 100%;
    padding: 22px;
    font-size: 28px;
    border-radius: var(--radius);
    border: 2px solid #333;
    background: var(--card2);
    color: var(--text);
    font-family: inherit;
    cursor: pointer;
    user-select: none;
    -webkit-user-select: none;
    transition: background .1s;
  }
  .pong-controls button:active { background: #333; }

  /* D-Pad Snake ‚Äî croix 3√ó3 */
  /*
     Grille  :  col1   col2   col3
     row 1   :  [ ]   [ ‚ñ≤ ]  [ ]
     row 2   :  [ ‚óÄ ] [ -- ] [ ‚ñ∂ ]
     row 3   :  [ ]   [ ‚ñº ]  [ ]
  */
  .snake-dpad {
    display: grid;
    grid-template-columns: repeat(3, 80px);
    grid-template-rows:    repeat(3, 80px);
    gap: 8px;
    margin-top: 18px;
  }
  .snake-dpad button {
    width: 80px;
    height: 80px;
    font-size: 34px;
    border-radius: 16px;
    border: 2px solid #444;
    background: var(--card2);
    color: var(--text);
    font-family: inherit;
    cursor: pointer;
    user-select: none;
    -webkit-user-select: none;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background .08s, transform .08s;
  }
  .snake-dpad button:active {
    background: #3a3a3a;
    transform: scale(.87);
    border-color: var(--green);
  }
  /* Placement dans la grille */
  .dpad-up    { grid-column: 2; grid-row: 1; }
  .dpad-left  { grid-column: 1; grid-row: 2; }
  .dpad-right { grid-column: 3; grid-row: 2; }
  .dpad-down  { grid-column: 2; grid-row: 3; }

  /* Bouton retour */
  .back-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: var(--card2);
    border: 1px solid #333;
    border-radius: 10px;
    color: var(--text);
    font-family: inherit;
    font-size: 14px;
    cursor: pointer;
    margin-bottom: 16px;
    align-self: flex-start;
    transition: border-color .2s;
  }
  .back-btn:hover { border-color: #555; }

  /* ================================================
     PAGE R√âCOMPENSES
  ================================================ */
  #page-rewards h2,
  #page-cgu h2 {
    font-size: 24px;
    color: var(--gold);
    margin-bottom: 20px;
    text-align: center;
  }

  .reward-card {
    background: var(--card2);
    border-radius: var(--radius);
    border: 1px solid #333;
    padding: 20px;
    text-align: center;
    margin-bottom: 14px;
  }

  .reward-card img {
    display: block;
    width: 180px;
    border-radius: 10px;
    margin: 14px auto;
  }

  .reward-price {
    font-size: 20px;
    font-weight: 800;
    color: var(--gold);
    margin-bottom: 8px;
  }

  .reward-window-box {
    background: rgba(255, 215, 0, .07);
    border: 1px solid rgba(255, 215, 0, .22);
    border-radius: 10px;
    padding: 10px 14px;
    font-size: 12px;
    color: var(--gold);
    text-align: left;
    line-height: 1.7;
    margin: 12px 0;
  }

  .reward-msg {
    padding: 10px;
    border-radius: 8px;
    margin-top: 12px;
    font-size: 13px;
    font-weight: 700;
    line-height: 1.5;
  }
  .reward-msg.ok  { background: rgba(46,  204, 113, .13); color: var(--green); }
  .reward-msg.err { background: rgba(231,  76,  60, .13); color: var(--red);   }

  /* ================================================
     PAGE CGU
  ================================================ */
  .cgu-section {
    margin-bottom: 18px;
    line-height: 1.85;
    color: var(--muted);
    font-size: 14px;
  }
  .cgu-section strong {
    display: block;
    color: var(--gold);
    font-size: 15px;
    margin-bottom: 5px;
  }

  /* ================================================
     SCROLLBAR
  ================================================ */
  ::-webkit-scrollbar       { width: 4px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
  </style>
</head>
<body>

<!-- ==================================================
     PAGE : CONNEXION
================================================== -->
<div id="page-login" class="page">

  <div class="logo-text">REWARD WEB</div>

  <p class="subtitle">
    Rewards financ√©es par des pubs ¬∑
    plus vous regardez des pubs,<br>plus vous gagnez des r√©compenses
  </p>

  <div class="login-providers">

    <button class="provider-btn" onclick="simulerConnexion('Google')">
      <img src="https://www.google.com/favicon.ico"
           onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Google_%22G%22_logo.svg/480px-Google_%22G%22_logo.svg.png'"
           alt="Google" />
      Google
    </button>

    <button class="provider-btn" onclick="simulerConnexion('Microsoft')">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/Microsoft_logo.svg/480px-Microsoft_logo.svg.png"
           alt="Microsoft" />
      Microsoft
    </button>

    <button class="provider-btn" onclick="simulerConnexion('iCloud')">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/Apple_logo_black.svg/480px-Apple_logo_black.svg.png"
           alt="iCloud" style="filter: invert(1)" />
      iCloud
    </button>

  </div>
</div><!-- /page-login -->


<!-- ==================================================
     PAGE : DASHBOARD
================================================== -->
<div id="page-dashboard" class="page hidden">

  <!-- Barre sup√©rieure -->
  <div class="top-bar">
    <h1>üéÆ REWARD WEB</h1>
    <button class="btn btn-dark"
            style="width:auto; padding:10px 16px; font-size:13px;"
            onclick="deconnecter()">
      D√©connexion
    </button>
  </div>

  <p style="font-size:13px; color:var(--muted); margin-bottom:16px;">
    Bienvenue, <strong id="user-name" style="color:var(--gold)">Joueur</strong> !
  </p>

  <!-- Compteur gold avec pi√®ce SVG -->
  <div class="gold-counter" id="gold-display">

    <!-- Pi√®ce dor√©e 3D inline SVG -->
    <svg width="54" height="54" viewBox="0 0 54 54"
         style="flex-shrink:0" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="coin-grad" cx="38%" cy="30%" r="62%">
          <stop offset="0%"   stop-color="#fff9a0"/>
          <stop offset="40%"  stop-color="#ffd700"/>
          <stop offset="80%"  stop-color="#ff9800"/>
          <stop offset="100%" stop-color="#b8730a"/>
        </radialGradient>
        <filter id="coin-shadow">
          <feDropShadow dx="0" dy="4" stdDeviation="3"
                        flood-color="#b8730a" flood-opacity=".55"/>
        </filter>
      </defs>
      <!-- Ombre port√©e -->
      <ellipse cx="27" cy="50" rx="18" ry="4" fill="rgba(0,0,0,.4)"/>
      <!-- Tranche (effet 3D) -->
      <ellipse cx="27" cy="31" rx="20" ry="20" fill="#7a4900"/>
      <!-- Face principale -->
      <ellipse cx="27" cy="28" rx="20" ry="20"
               fill="url(#coin-grad)" filter="url(#coin-shadow)"/>
      <!-- Bordure brillante -->
      <ellipse cx="27" cy="28" rx="20" ry="20"
               fill="none" stroke="#ffe566" stroke-width="1.5" opacity=".7"/>
      <!-- Lettre G en relief -->
      <text x="27" y="35" text-anchor="middle" font-size="21" font-weight="900"
            font-family="Georgia,serif" fill="#b8730a" opacity=".4"
            dx="1" dy="1">G</text>
      <text x="27" y="35" text-anchor="middle" font-size="21" font-weight="900"
            font-family="Georgia,serif" fill="#fff8dc">G</text>
    </svg>

    <div>
      <div class="amount" id="gold-count">0</div>
      <div class="label">gold disponible</div>
    </div>
  </div>

  <!-- Message sondage clignotant -->
  <div class="survey-msg blink">
    ‚ö†Ô∏è SONDAGE √Ä VENIR pour d√©cider de la prochaine r√©compense<br>
    ‚Äî PARTAGEZ MASSIVEMENT !
  </div>

  <!-- Pub -->
  <div class="card">
    <div class="section-title">üí∞ Gagner du gold</div>
    <button class="btn btn-gold" id="btn-pub" onclick="regarderPub()">
      üì∫ Regarder pub (+20 gold)
    </button>
  </div>

  <!-- Jeux -->
  <div class="card">
    <div class="section-title">üéÆ Mini-jeux (+5 gold par minute jou√©e)</div>
    <div class="games-grid">
      <button class="btn-game" onclick="lancerJeu('pong')">
        <span class="icon">üèì</span>Pong
      </button>
      <button class="btn-game" onclick="lancerJeu('snake')">
        <span class="icon">üêç</span>Snake
      </button>
    </div>
  </div>

  <!-- Navigation -->
  <div class="nav-grid">
    <button class="btn btn-dark" onclick="afficherPage('page-rewards')">üéÅ R√©compenses</button>
    <button class="btn btn-dark" onclick="afficherPage('page-cgu')">üìÑ CGU</button>
  </div>

</div><!-- /page-dashboard -->


<!-- ==================================================
     PAGE : JEU
================================================== -->
<div id="page-game" class="page hidden">

  <button class="back-btn" onclick="quitterJeu()">‚Üê Retour</button>

  <h2 id="game-title">Jeu</h2>
  <div class="game-info" id="game-info">...</div>

  <!-- Canvas commun Pong / Snake -->
  <canvas id="game-canvas" width="320" height="288"></canvas>

  <!-- Barre progression +5 gold -->
  <div class="gold-timer" id="gold-timer">
    <span id="timer-label">‚è± +5 gold dans <span id="timer-secs">60</span>s</span>
    <div class="timer-track">
      <div class="timer-fill" id="timer-fill"></div>
    </div>
  </div>

  <!-- Contr√¥les Pong (haut/bas) -->
  <div id="pong-controls" class="pong-controls hidden">
    <button ontouchstart="pongDir=-1; event.preventDefault()"
            ontouchend="pongDir=0"
            onmousedown="pongDir=-1"
            onmouseup="pongDir=0">‚ñ≤</button>
    <button ontouchstart="pongDir=1; event.preventDefault()"
            ontouchend="pongDir=0"
            onmousedown="pongDir=1"
            onmouseup="pongDir=0">‚ñº</button>
  </div>

  <!--
    D-Pad Snake ‚Äî grille CSS 3√ó3.
    Seuls 4 boutons sont plac√©s (haut, gauche, droite, bas).
    Les 5 autres cellules restent vides ‚Üí croix naturelle.
    setSnakeDir() est une fonction GLOBALE accessible depuis l'HTML.
  -->
  <div id="snake-controls" class="snake-dpad hidden">
    <button class="dpad-up"
            ontouchstart="setSnakeDir(0,-1); event.preventDefault()"
            onmousedown="setSnakeDir(0,-1)">‚ñ≤</button>

    <button class="dpad-left"
            ontouchstart="setSnakeDir(-1,0); event.preventDefault()"
            onmousedown="setSnakeDir(-1,0)">‚óÄ</button>

    <button class="dpad-right"
            ontouchstart="setSnakeDir(1,0); event.preventDefault()"
            onmousedown="setSnakeDir(1,0)">‚ñ∂</button>

    <button class="dpad-down"
            ontouchstart="setSnakeDir(0,1); event.preventDefault()"
            onmousedown="setSnakeDir(0,1)">‚ñº</button>
  </div>

</div><!-- /page-game -->


<!-- ==================================================
     PAGE : R√âCOMPENSES
================================================== -->
<div id="page-rewards" class="page hidden">

  <button class="back-btn" onclick="afficherPage('page-dashboard')">‚Üê Retour</button>
  <h2>üéÅ R√©compenses</h2>

  <div class="reward-card">
    <div class="reward-price">5 000 gold = 800 Robux</div>

    <img src="https://placehold.co/180x112/cc0000/ffffff?text=Roblox+Gift+Card"
         alt="Carte cadeau Roblox"
         onerror="this.style.display='none'" />

    <div class="reward-window-box">
      üìÖ <strong>Fen√™tre de retrait mensuelle :</strong>
      les retraits ne sont accept√©s que pendant la <strong>semaine exclusive</strong>
      d√©sign√©e chaque mois. Un seul retrait par personne et par mois est autoris√©.
      Suivez nos r√©seaux sociaux pour conna√Ætre les dates.
    </div>

    <p style="font-size:13px; color:var(--muted); margin-top:4px;">
      Ton solde : <strong id="rewards-gold" style="color:var(--gold)">0</strong> gold
    </p>

    <button class="btn btn-green" style="margin-top:14px;" onclick="retirerRecompense()">
      Retirer 800 Robux
    </button>

    <div id="reward-msg" class="reward-msg hidden"></div>
  </div>

</div><!-- /page-rewards -->


<!-- ==================================================
     PAGE : CGU
================================================== -->
<div id="page-cgu" class="page hidden">

  <button class="back-btn" onclick="afficherPage('page-dashboard')">‚Üê Retour</button>
  <h2>üìÑ CGU</h2>

  <div class="card">

    <div class="cgu-section">
      <strong>1. Fonctionnement du service</strong>
      Les rewards sont financ√©es par des publicit√©s. Plus vous regardez des pubs,
      plus vous gagnez des r√©compenses. Le gold est √©galement gagn√© en jouant aux
      mini-jeux (+5 gold par minute jou√©e) ou via les bonus promotionnels.
    </div>

    <div class="cgu-section">
      <strong>2. Nature du gold</strong>
      Le gold accumul√© est strictement virtuel et ne poss√®de aucune valeur mon√©taire r√©elle.
      Il ne peut √™tre √©chang√© que contre les r√©compenses disponibles sur la plateforme
      (ex. : Robux).
    </div>

    <div class="cgu-section">
      <strong>3. Fen√™tre de retrait mensuelle exclusive</strong>
      Les retraits de r√©compenses ne sont autoris√©s que durant la
      <strong>semaine exclusive d√©sign√©e chaque mois</strong> par REWARD WEB.
      En dehors de cette p√©riode, aucune demande de retrait ne sera trait√©e.
      Chaque utilisateur ne peut effectuer <strong>qu'un seul retrait par mois</strong>,
      quelle que soit son accumulation de gold.
      Les dates de la fen√™tre mensuelle sont communiqu√©es √† l'avance via nos r√©seaux sociaux.
    </div>

    <div class="cgu-section">
      <strong>4. Traitement des retraits</strong>
      Les retraits approuv√©s sont trait√©s dans un d√©lai de 24 h √† 48 h suivant la validation.
      REWARD WEB se r√©serve le droit de suspendre ou d'annuler un retrait en cas de fraude,
      d'abus ou de non-respect des pr√©sentes CGU.
    </div>

    <div class="cgu-section">
      <strong>5. Conditions d'utilisation</strong>
      En utilisant REWARD WEB, vous confirmez avoir plus de 13 ans et acceptez l'ensemble
      des pr√©sentes conditions. REWARD WEB se r√©serve le droit de modifier ces CGU √† tout
      moment ; les modifications entrent en vigueur d√®s leur publication.
    </div>

    <div class="cgu-section">
      <strong>6. Limitation de responsabilit√©</strong>
      REWARD WEB ne saurait √™tre tenu responsable de la perte de gold due √† la suppression
      de donn√©es de navigation. La plateforme est fournie "en l'√©tat" sans garantie de
      disponibilit√© permanente.
    </div>

    <em style="color:var(--muted); font-size:12px;">Version 2.0 ‚Äî 2025</em>

  </div>

</div><!-- /page-cgu -->


<!-- ==================================================
     JAVASCRIPT
================================================== -->
<script>
"use strict";

/* ====================================================
   CONSTANTES
==================================================== */
const PAGES    = ['page-login','page-dashboard','page-game','page-rewards','page-cgu'];
const LS_GOLD  = 'rw_gold';
const LS_CONN  = 'rw_connected';
const LS_USER  = 'rw_user';

/* ====================================================
   GOLD
==================================================== */
let gold = parseInt(localStorage.getItem(LS_GOLD) || '0', 10);

function sauvegarderGold() {
  localStorage.setItem(LS_GOLD, gold);
}

function majAffichageGold() {
  const affichage = gold.toLocaleString('fr-FR');
  const el1 = document.getElementById('gold-count');
  const el2 = document.getElementById('rewards-gold');
  if (el1) el1.textContent = affichage;
  if (el2) el2.textContent = affichage;
}

function ajouterGold(montant) {
  gold = Math.max(0, gold + montant);
  sauvegarderGold();
  majAffichageGold();
  // Flash visuel si gain positif
  if (montant > 0) {
    const el = document.getElementById('gold-display');
    if (el) {
      el.classList.remove('flash');
      void el.offsetWidth; // force reflow pour relancer l'animation
      el.classList.add('flash');
    }
  }
}

/* ====================================================
   NAVIGATION
==================================================== */
function afficherPage(id) {
  PAGES.forEach(p => document.getElementById(p).classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  if (id === 'page-rewards') majAffichageGold();
}

/* ====================================================
   CONNEXION / D√âCONNEXION
==================================================== */
function simulerConnexion(provider) {
  localStorage.setItem(LS_CONN, 'true');
  localStorage.setItem(LS_USER, provider + ' User');
  chargerDashboard();
}

function chargerDashboard() {
  const nom = localStorage.getItem(LS_USER) || 'Joueur';
  document.getElementById('user-name').textContent = nom;
  majAffichageGold();
  afficherPage('page-dashboard');
}

function deconnecter() {
  if (!confirm('D√©connexion ?\nTon gold est sauvegard√© localement.')) return;
  localStorage.removeItem(LS_CONN);
  localStorage.removeItem(LS_USER);
  location.reload();
}

/* ====================================================
   PUB SIMUL√âE
==================================================== */
let pubEnCours = false;

function regarderPub() {
  if (pubEnCours) return;
  pubEnCours = true;

  const btn = document.getElementById('btn-pub');
  btn.disabled = true;
  btn.textContent = '‚è≥ Pub en cours... (2s)';

  setTimeout(() => {
    ajouterGold(20);
    btn.disabled = false;
    btn.textContent = 'üì∫ Regarder pub (+20 gold)';
    pubEnCours = false;
    alert('‚úÖ +20 gold ! Pub termin√©e.');
  }, 2000);
}

/* ====================================================
   TIMER JEU ‚Äî +5 gold par minute CONS√âCUTIVE

   R√®gle :
   - Toutes les 60 secondes pass√©es sans interruption
     dans un jeu ‚Üí +5 gold automatiquement.
   - Si on quitte, perd ou relance ‚Üí compteur remis √† 0.
   - Pas d'autre source de gold dans les jeux.
==================================================== */
let jeuActif    = false;
let timerSecondes = 0;          // secondes √©coul√©es depuis le d√©but / dernier palier
let timerInterval = null;       // setInterval 1s

function demarrerTimerJeu() {
  timerSecondes = 0;
  _majBarreTimer();
  if (timerInterval) clearInterval(timerInterval);

  timerInterval = setInterval(() => {
    if (!jeuActif) return;
    timerSecondes++;

    _majBarreTimer();

    // Palier de 60s atteint ‚Üí +5 gold, puis on repart pour une nouvelle minute
    if (timerSecondes >= 60) {
      timerSecondes = 0;
      ajouterGold(5);
      _majBarreTimer(); // reset visuel imm√©diat
    }
  }, 1000);
}

function stopTimerJeu() {
  clearInterval(timerInterval);
  timerInterval = null;
  timerSecondes = 0;
  _majBarreTimer();
}

function _majBarreTimer() {
  const fill  = document.getElementById('timer-fill');
  const label = document.getElementById('timer-secs');
  if (fill)  fill.style.width = (timerSecondes / 60 * 100) + '%';
  if (label) label.textContent = 60 - timerSecondes;
}

/* ====================================================
   GESTION DES JEUX
==================================================== */
let jeuActuel  = null;   // 'pong' | 'snake'
let pongRAF    = null;   // requestAnimationFrame id
let snakeTimer = null;   // setInterval id

function lancerJeu(type) {
  _stopToutJeu(); // arr√™ter proprement tout jeu en cours

  jeuActuel = type;
  jeuActif  = true;
  afficherPage('page-game');

  // Cacher les deux sets de contr√¥les
  document.getElementById('pong-controls').classList.add('hidden');
  document.getElementById('snake-controls').classList.add('hidden');

  if (type === 'pong') {
    document.getElementById('game-title').textContent = 'üèì Pong';
    document.getElementById('game-info').textContent  =
      '‚ñ≤‚ñº clavier ou boutons ¬∑ si la balle d√©passe ta raquette ‚Üí game over';
    document.getElementById('pong-controls').classList.remove('hidden');
    _initPong();

  } else { // snake
    document.getElementById('game-title').textContent = 'üêç Snake';
    document.getElementById('game-info').textContent  =
      'D-Pad ou fl√®ches clavier ¬∑ √©vite les murs et toi-m√™me';
    document.getElementById('snake-controls').classList.remove('hidden');
    _initSnake();
  }

  demarrerTimerJeu();
}

function quitterJeu() {
  _stopToutJeu();
  afficherPage('page-dashboard');
}

function _stopToutJeu() {
  jeuActif = false;
  stopTimerJeu();

  if (pongRAF)    { cancelAnimationFrame(pongRAF); pongRAF = null; }
  if (snakeTimer) { clearInterval(snakeTimer);     snakeTimer = null; }

  // Retirer les √©couteurs clavier
  document.onkeydown = null;
  document.onkeyup   = null;
}

/* ====================================================
   PONG

   R√®gles :
   - Raquette joueur √† droite (contr√¥le clavier ou boutons).
   - Raquette IA √† gauche.
   - Si la balle d√©passe la raquette du JOUEUR (bord droit)
     ‚Üí game over pour le joueur.
   - Si la balle sort du bord gauche (IA rate) ‚Üí reset silencieux.
   - Aucun gold donn√© par le Pong lui-m√™me.
==================================================== */
let pongDir = 0; // -1 = haut, 0 = arr√™t, 1 = bas

function _initPong() {
  const canvas = document.getElementById('game-canvas');
  const ctx    = canvas.getContext('2d');
  const W = canvas.width;
  const H = canvas.height;

  const PADDLE_H = 60;
  const PADDLE_W = 12;

  let bx  = W / 2;   let by  = H / 2;
  let vx  = 4.5;     let vy  = 3;
  let py  = H / 2 - PADDLE_H / 2; // joueur (droite)
  let iy  = H / 2 - PADDLE_H / 2; // IA (gauche)
  let goEnCours = false;

  pongDir = 0;

  // Clavier
  document.onkeydown = (e) => {
    if (e.key === 'ArrowUp')   { pongDir = -1; e.preventDefault(); }
    if (e.key === 'ArrowDown') { pongDir =  1; e.preventDefault(); }
  };
  document.onkeyup = (e) => {
    if (e.key === 'ArrowUp' || e.key === 'ArrowDown') pongDir = 0;
  };

  function resetBalle() {
    bx = W / 2; by = H / 2;
    vx = (Math.random() > .5 ? 1 : -1) * 4.5;
    vy = (Math.random() > .5 ? 1 : -1) * 3.0;
  }

  function gameOverPong() {
    if (goEnCours) return;
    goEnCours = true;
    jeuActif  = false;
    stopTimerJeu();
    cancelAnimationFrame(pongRAF); pongRAF = null;

    setTimeout(() => {
      const rejouer = confirm('üí• Game Over ! La balle a d√©pass√© ta raquette.\n(Aucun gold perdu)\n\nRejouer ?');
      if (rejouer) {
        lancerJeu('pong');
      } else {
        quitterJeu();
      }
    }, 60);
  }

  function loop() {
    if (!jeuActif || jeuActuel !== 'pong' || goEnCours) return;

    // --- D√©placement joueur ---
    py = Math.max(0, Math.min(H - PADDLE_H, py + pongDir * 5));

    // --- IA suit la balle ---
    const mid = iy + PADDLE_H / 2;
    if (mid < by - 3) iy = Math.min(H - PADDLE_H, iy + 3.2);
    if (mid > by + 3) iy = Math.max(0,             iy - 3.2);

    // --- Mouvement balle ---
    bx += vx;
    by += vy;

    // Murs haut / bas
    if (by <= 6)     { by = 6;     vy =  Math.abs(vy); }
    if (by >= H - 6) { by = H - 6; vy = -Math.abs(vy); }

    // Collision raquette joueur (droite)
    if (vx > 0 && bx >= W - PADDLE_W - 14
        && by >= py && by <= py + PADDLE_H) {
      vx = -(Math.abs(vx) + 0.2);
      vy += (Math.random() - .5) * 1.5;
      bx  = W - PADDLE_W - 15; // emp√™che chevauchement
    }

    // Collision raquette IA (gauche)
    if (vx < 0 && bx <= PADDLE_W + 14
        && by >= iy && by <= iy + PADDLE_H) {
      vx = Math.abs(vx) + 0.15;
      bx = PADDLE_W + 15;
    }

    // Balle sort c√¥t√© gauche ‚Üí IA rate ‚Üí reset (pas de gold)
    if (bx < 0) {
      resetBalle();
    }

    // Balle sort c√¥t√© droit ‚Üí JOUEUR a rat√© ‚Üí GAME OVER
    if (bx > W) {
      gameOverPong();
      return;
    }

    // --- Rendu ---
    ctx.fillStyle = '#111';
    ctx.fillRect(0, 0, W, H);

    // Ligne centrale pointill√©e
    ctx.save();
    ctx.setLineDash([6, 8]);
    ctx.strokeStyle = '#2a2a2a';
    ctx.lineWidth   = 2;
    ctx.beginPath();
    ctx.moveTo(W / 2, 0);
    ctx.lineTo(W / 2, H);
    ctx.stroke();
    ctx.restore();

    // Raquette joueur (or)
    ctx.fillStyle = '#ffd700';
    ctx.beginPath();
    ctx.roundRect(W - PADDLE_W - 10, py, PADDLE_W, PADDLE_H, 4);
    ctx.fill();

    // Raquette IA (rouge)
    ctx.fillStyle = '#e74c3c';
    ctx.beginPath();
    ctx.roundRect(10, iy, PADDLE_W, PADDLE_H, 4);
    ctx.fill();

    // Balle
    ctx.fillStyle = '#ffffff';
    ctx.beginPath();
    ctx.arc(bx, by, 8, 0, Math.PI * 2);
    ctx.fill();

    pongRAF = requestAnimationFrame(loop);
  }

  resetBalle();
  pongRAF = requestAnimationFrame(loop);
}

/* ====================================================
   SNAKE

   R√®gles :
   - La mort (mur ou soi-m√™me) ‚Üí game over, 0 gold.
   - Aucun gold li√© aux nourritures ou √† la mort.
   - Les seuls gold en jeu viennent du timer 60s.

   snakeCurrDir / snakeNextDir sont GLOBALES pour que
   setSnakeDir() soit accessible depuis l'HTML.
==================================================== */
let snakeCurrDir = { x: 1, y: 0 };
let snakeNextDir = { x: 1, y: 0 };

/**
 * Appel√©e par les boutons du D-Pad (inline onmousedown / ontouchstart).
 * Fonction globale ‚Äî ne pas d√©placer dans une port√©e locale.
 */
function setSnakeDir(dx, dy) {
  // Bloquer le demi-tour imm√©diat
  if (dx !== 0 && snakeCurrDir.x !== 0) return;
  if (dy !== 0 && snakeCurrDir.y !== 0) return;
  snakeNextDir = { x: dx, y: dy };
}

function _initSnake() {
  const canvas = document.getElementById('game-canvas');
  const ctx    = canvas.getContext('2d');

  const COLS = 20;
  const ROWS = 18;
  const TW   = Math.floor(canvas.width  / COLS);
  const TH   = Math.floor(canvas.height / ROWS);

  // Reset des directions globales
  snakeCurrDir = { x: 1, y: 0 };
  snakeNextDir = { x: 1, y: 0 };

  let serpent    = [{ x: 5, y: 9 }, { x: 4, y: 9 }, { x: 3, y: 9 }];
  let nourriture = _nouvNourriture();
  let score      = 0;
  let goEnCours  = false;

  function _nouvNourriture() {
    let f;
    do {
      f = {
        x: Math.floor(Math.random() * COLS),
        y: Math.floor(Math.random() * ROWS)
      };
    } while (serpent.some(s => s.x === f.x && s.y === f.y));
    return f;
  }

  // Clavier Snake
  document.onkeydown = (e) => {
    switch (e.key) {
      case 'ArrowUp':    setSnakeDir( 0, -1); e.preventDefault(); break;
      case 'ArrowDown':  setSnakeDir( 0,  1); e.preventDefault(); break;
      case 'ArrowLeft':  setSnakeDir(-1,  0); e.preventDefault(); break;
      case 'ArrowRight': setSnakeDir( 1,  0); e.preventDefault(); break;
    }
  };

  function render() {
    // Fond
    ctx.fillStyle = '#111';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Grille discr√®te
    ctx.strokeStyle = '#1c1c1c';
    ctx.lineWidth   = 0.5;
    for (let c = 0; c < COLS; c++) {
      ctx.beginPath();
      ctx.moveTo(c * TW, 0);
      ctx.lineTo(c * TW, canvas.height);
      ctx.stroke();
    }
    for (let r = 0; r < ROWS; r++) {
      ctx.beginPath();
      ctx.moveTo(0, r * TH);
      ctx.lineTo(canvas.width, r * TH);
      ctx.stroke();
    }

    // Nourriture (cercle rouge)
    ctx.fillStyle = '#e74c3c';
    ctx.beginPath();
    ctx.arc(
      nourriture.x * TW + TW / 2,
      nourriture.y * TH + TH / 2,
      TW / 2 - 1, 0, Math.PI * 2
    );
    ctx.fill();

    // Serpent
    serpent.forEach((seg, i) => {
      ctx.fillStyle = i === 0 ? '#2ecc71'
                    : (i % 2 === 0 ? '#27ae60' : '#229954');
      ctx.beginPath();
      ctx.roundRect(seg.x * TW + 1, seg.y * TH + 1, TW - 2, TH - 2, 3);
      ctx.fill();
    });

    // Score
    ctx.fillStyle = 'rgba(255,215,0,.85)';
    ctx.font      = 'bold 13px Segoe UI, Arial, sans-serif';
    ctx.fillText('Score : ' + score, 8, 18);
  }

  function step() {
    if (!jeuActif || jeuActuel !== 'snake' || goEnCours) return;

    // Appliquer la direction demand√©e
    snakeCurrDir = { ...snakeNextDir };

    const tete = {
      x: serpent[0].x + snakeCurrDir.x,
      y: serpent[0].y + snakeCurrDir.y
    };

    // Collision mur
    if (tete.x < 0 || tete.x >= COLS || tete.y < 0 || tete.y >= ROWS) {
      _gameOverSnake(); return;
    }
    // Collision corps (on ignore la queue qui va dispara√Ætre)
    if (serpent.slice(0, -1).some(s => s.x === tete.x && s.y === tete.y)) {
      _gameOverSnake(); return;
    }

    serpent.unshift(tete);

    // Mange la nourriture ?
    if (tete.x === nourriture.x && tete.y === nourriture.y) {
      score++;
      nourriture = _nouvNourriture();
      // Pas de gold ici ‚Äî uniquement le timer 60s donne du gold
    } else {
      serpent.pop();
    }

    render();
  }

  function _gameOverSnake() {
    goEnCours = true;
    clearInterval(snakeTimer); snakeTimer = null;
    jeuActif = false;
    stopTimerJeu(); // remet le compteur √† 0 ‚Äî pas de gold partiel

    setTimeout(() => {
      const rejouer = confirm(
        'üíÄ Game Over !\nScore : ' + score +
        '\n(Aucun gold pour une partie perdue)\n\nRejouer ?'
      );
      if (rejouer) {
        lancerJeu('snake'); // relance avec timer remis √† 0
      } else {
        quitterJeu();
      }
    }, 80);
  }

  render();
  if (snakeTimer) clearInterval(snakeTimer);
  snakeTimer = setInterval(step, 130);
}

/* ====================================================
   R√âCOMPENSES
==================================================== */
function retirerRecompense() {
  const msg = document.getElementById('reward-msg');
  msg.classList.remove('hidden', 'ok', 'err');

  if (gold < 5000) {
    msg.classList.add('err');
    msg.textContent =
      '‚ùå Gold insuffisant ! Il te faut 5 000 gold'
      + ' (tu en as ' + gold.toLocaleString('fr-FR') + ').';
  } else {
    ajouterGold(-5000);
    msg.classList.add('ok');
    msg.textContent =
      '‚úÖ Retrait demand√© ! Tu recevras tes Robux'
      + ' durant la fen√™tre de retrait mensuelle (sous 24‚Äì48 h).';
  }

  setTimeout(() => msg.classList.add('hidden'), 5000);
}

/* ====================================================
   INITIALISATION
==================================================== */
(function init() {
  if (localStorage.getItem(LS_CONN) === 'true') {
    chargerDashboard();
  } else {
    afficherPage('page-login');
  }
}());
</script>

</body>
</html>
