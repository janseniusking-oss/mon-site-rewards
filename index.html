<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#111111" />
  <meta name="description" content="REWARD WEB - Gagne des Robux gratuits en regardant des pubs !" />
  <title>REWARD WEB - Gagne Robux Gratuit</title>
  <!-- Favicon pi√®ce dor√©e SVG -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3CradialGradient id='g' cx='38%25' cy='30%25' r='62%25'%3E%3Cstop offset='0%25' stop-color='%23fff9a0'/%3E%3Cstop offset='40%25' stop-color='%23ffd700'/%3E%3Cstop offset='80%25' stop-color='%23ff9800'/%3E%3Cstop offset='100%25' stop-color='%23b8730a'/%3E%3C/radialGradient%3E%3C/defs%3E%3Cellipse cx='32' cy='58' rx='20' ry='5' fill='rgba(0,0,0,0.3)'/%3E%3Cellipse cx='32' cy='37' rx='24' ry='24' fill='%237a4900'/%3E%3Cellipse cx='32' cy='33' rx='24' ry='24' fill='url(%23g)'/%3E%3Cellipse cx='32' cy='33' rx='24' ry='24' fill='none' stroke='%23ffe566' stroke-width='2' opacity='0.7'/%3E%3Ctext x='32' y='42' text-anchor='middle' font-size='26' font-weight='900' font-family='Georgia,serif' fill='%23b8730a' opacity='0.4' dx='1' dy='1'%3EG%3C/text%3E%3Ctext x='32' y='42' text-anchor='middle' font-size='26' font-weight='900' font-family='Georgia,serif' fill='%23fff8dc'%3EG%3C/text%3E%3C/svg%3E" />

  <style>
  /* ================================================
     VARIABLES
  ================================================ */
  :root {
    --bg:     #111111;
    --card:   #1a1a1a;
    --card2:  #222222;
    --border: #2a2a2a;
    --gold:   #ffd700;
    --green:  #2ecc71;
    --red:    #e74c3c;
    --text:   #eeeeee;
    --muted:  #888888;
    --radius: 14px;
  }

  /* ================================================
     RESET
  ================================================ */
  *, *::before, *::after {
    box-sizing: border-box;
    margin: 0; padding: 0;
    -webkit-tap-highlight-color: transparent;
  }
  html, body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
    min-height: 100%;
    overflow-x: hidden;
  }

  /* ================================================
     UTILITAIRES
  ================================================ */
  .hidden { display: none !important; }

  .page {
    min-height: 100vh;
    padding: 24px 16px 48px;
    max-width: 480px;
    margin: 0 auto;
  }

  /* ================================================
     BOUTONS
  ================================================ */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    width: 100%;
    padding: 14px 22px;
    border: none;
    border-radius: var(--radius);
    font-family: inherit;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    transition: transform .12s, opacity .15s;
  }
  .btn:active   { transform: scale(.96); }
  .btn:disabled { opacity: .45; cursor: not-allowed; transform: none; }
  .btn-gold  { background: linear-gradient(135deg, #ffd700, #ff9800); color: #111; }
  .btn-green { background: linear-gradient(135deg, #2ecc71, #27ae60); color: #fff; }
  .btn-dark  { background: var(--card2); color: var(--text); border: 1px solid #333; }

  /* ================================================
     CARD
  ================================================ */
  .card {
    background: var(--card2);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    padding: 18px;
    margin-bottom: 14px;
  }
  .section-title {
    font-size: 12px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1.2px;
    margin-bottom: 10px;
  }

  /* ================================================
     ANIMATIONS
  ================================================ */
  @keyframes flash-gold {
    0%   { background: rgba(255,215,0,.32); border-color: var(--gold); }
    100% { background: var(--card2);        border-color: #333; }
  }
  .flash { animation: flash-gold .7s ease-out; }

  @keyframes blink {
    0%,100% { opacity: 1; }
    50%      { opacity: 0; }
  }
  .blink { animation: blink 1.1s infinite; }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* ================================================
     √âCRAN DE CHARGEMENT
  ================================================ */
  #page-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 20px;
  }
  .spinner {
    width: 48px; height: 48px;
    border: 4px solid #333;
    border-top-color: var(--gold);
    border-radius: 50%;
    animation: spin .8s linear infinite;
  }
  .loading-text {
    font-size: 14px;
    color: var(--muted);
  }

  /* ================================================
     PAGE CONNEXION
  ================================================ */
  #page-login {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
  }
  .logo-text {
    font-size: 46px;
    font-weight: 900;
    letter-spacing: 4px;
    background: linear-gradient(135deg, #ffd700, #ff9800);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 10px;
  }
  .subtitle {
    font-size: 13px;
    color: var(--muted);
    max-width: 300px;
    margin: 0 auto 36px;
    line-height: 1.7;
  }

  /* Bouton Google */
  .google-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 14px;
    width: 100%;
    max-width: 300px;
    padding: 16px 24px;
    background: #fff;
    border: none;
    border-radius: var(--radius);
    font-family: inherit;
    font-size: 16px;
    font-weight: 700;
    color: #333;
    cursor: pointer;
    transition: transform .12s, box-shadow .2s;
    box-shadow: 0 2px 12px rgba(0,0,0,.3);
  }
  .google-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,.4);
  }
  .google-btn:active { transform: scale(.96); }
  .google-btn img { width: 24px; height: 24px; }

  .login-note {
    font-size: 12px;
    color: var(--muted);
    margin-top: 20px;
    max-width: 260px;
    text-align: center;
    line-height: 1.6;
  }

  /* ================================================
     DASHBOARD
  ================================================ */
  .top-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }
  .top-bar h1 { font-size: 22px; font-weight: 900; color: var(--gold); }

  /* Info utilisateur */
  .user-info {
    display: flex;
    align-items: center;
    gap: 12px;
    background: var(--card2);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    padding: 12px 16px;
    margin-bottom: 14px;
  }
  .user-avatar {
    width: 40px; height: 40px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid var(--gold);
  }
  .user-avatar-placeholder {
    width: 40px; height: 40px;
    border-radius: 50%;
    background: var(--gold);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: 900;
    color: #111;
    flex-shrink: 0;
  }
  .user-details { flex: 1; }
  .user-name  { font-size: 14px; font-weight: 700; color: var(--text); }
  .user-email { font-size: 11px; color: var(--muted); margin-top: 2px; }
  .sync-badge {
    font-size: 10px;
    background: rgba(46,204,113,.15);
    color: var(--green);
    border: 1px solid rgba(46,204,113,.3);
    border-radius: 6px;
    padding: 3px 7px;
    font-weight: 700;
  }

  /* Compteur gold */
  .gold-counter {
    display: flex;
    align-items: center;
    gap: 14px;
    background: var(--card2);
    border-radius: var(--radius);
    border: 1px solid #333;
    padding: 16px 18px;
    margin-bottom: 14px;
    transition: background .3s, border-color .3s;
  }
  .gold-counter .amount { font-size: 38px; font-weight: 900; color: var(--gold); }
  .gold-counter .label  { font-size: 13px; color: var(--muted); margin-top: 2px; }

  /* Sondage */
  .survey-msg {
    background: rgba(231,76,60,.12);
    border: 1px solid var(--red);
    border-radius: var(--radius);
    padding: 12px 16px;
    font-size: 12px;
    font-weight: 700;
    color: var(--red);
    text-align: center;
    line-height: 1.6;
    margin-bottom: 14px;
  }

  /* Grille jeux */
  .games-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }
  .btn-game {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    padding: 18px 10px;
    background: var(--card2);
    border: 2px solid #333;
    border-radius: var(--radius);
    color: var(--text);
    font-family: inherit;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    transition: border-color .2s, transform .12s;
  }
  .btn-game:hover  { border-color: var(--green); transform: translateY(-2px); }
  .btn-game:active { transform: scale(.95); }
  .btn-game .icon  { font-size: 30px; }

  .nav-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 14px;
  }

  /* ================================================
     PAGE JEU
  ================================================ */
  #page-game {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-bottom: 32px;
  }
  #page-game h2 { font-size: 22px; color: var(--gold); margin-bottom: 6px; }
  .game-info {
    font-size: 12px;
    color: var(--muted);
    margin-bottom: 12px;
    text-align: center;
  }
  #game-canvas {
    display: block;
    width: 100%;
    max-width: 340px;
    border-radius: 12px;
    border: 2px solid var(--border);
    touch-action: none;
  }

  /* Timer gold */
  .gold-timer {
    width: 100%;
    max-width: 340px;
    margin-top: 12px;
    padding: 10px 14px;
    background: var(--card2);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 12px;
    color: var(--muted);
  }
  .timer-track {
    height: 7px;
    background: #333;
    border-radius: 4px;
    overflow: hidden;
    margin-top: 6px;
  }
  .timer-fill {
    height: 100%;
    border-radius: 4px;
    background: linear-gradient(90deg, #2ecc71, #ffd700);
    transition: width 1s linear;
    width: 0%;
  }

  /* Contr√¥les Pong */
  .pong-controls {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 14px;
    width: 100%;
    max-width: 340px;
  }
  .pong-controls button {
    width: 100%; padding: 22px;
    font-size: 28px;
    border-radius: var(--radius);
    border: 2px solid #333;
    background: var(--card2);
    color: var(--text);
    font-family: inherit;
    cursor: pointer;
    user-select: none;
    -webkit-user-select: none;
    transition: background .1s;
  }
  .pong-controls button:active { background: #333; }

  /* D-Pad Snake */
  .snake-dpad {
    display: grid;
    grid-template-columns: repeat(3, 80px);
    grid-template-rows:    repeat(3, 80px);
    gap: 8px;
    margin-top: 18px;
  }
  .snake-dpad button {
    width: 80px; height: 80px;
    font-size: 34px;
    border-radius: 16px;
    border: 2px solid #444;
    background: var(--card2);
    color: var(--text);
    font-family: inherit;
    cursor: pointer;
    user-select: none;
    -webkit-user-select: none;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background .08s, transform .08s;
  }
  .snake-dpad button:active {
    background: #3a3a3a;
    transform: scale(.87);
    border-color: var(--green);
  }
  .dpad-up    { grid-column: 2; grid-row: 1; }
  .dpad-left  { grid-column: 1; grid-row: 2; }
  .dpad-right { grid-column: 3; grid-row: 2; }
  .dpad-down  { grid-column: 2; grid-row: 3; }

  /* Bouton retour */
  .back-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: var(--card2);
    border: 1px solid #333;
    border-radius: 10px;
    color: var(--text);
    font-family: inherit;
    font-size: 14px;
    cursor: pointer;
    margin-bottom: 16px;
    align-self: flex-start;
    transition: border-color .2s;
  }
  .back-btn:hover { border-color: #555; }

  /* ================================================
     PAGE R√âCOMPENSES
  ================================================ */
  #page-rewards h2, #page-cgu h2 {
    font-size: 24px;
    color: var(--gold);
    margin-bottom: 20px;
    text-align: center;
  }
  .reward-card {
    background: var(--card2);
    border-radius: var(--radius);
    border: 1px solid #333;
    padding: 20px;
    text-align: center;
    margin-bottom: 14px;
  }
  .reward-card img {
    display: block;
    width: 180px;
    border-radius: 10px;
    margin: 14px auto;
  }
  .reward-price {
    font-size: 20px;
    font-weight: 800;
    color: var(--gold);
    margin-bottom: 8px;
  }
  .reward-window-box {
    background: rgba(255,215,0,.07);
    border: 1px solid rgba(255,215,0,.22);
    border-radius: 10px;
    padding: 10px 14px;
    font-size: 12px;
    color: var(--gold);
    text-align: left;
    line-height: 1.7;
    margin: 12px 0;
  }
  .reward-msg {
    padding: 10px;
    border-radius: 8px;
    margin-top: 12px;
    font-size: 13px;
    font-weight: 700;
    line-height: 1.5;
  }
  .reward-msg.ok  { background: rgba(46,204,113,.13); color: var(--green); }
  .reward-msg.err { background: rgba(231,76,60,.13);  color: var(--red);   }

  /* ================================================
     PAGE CGU
  ================================================ */
  .cgu-section {
    margin-bottom: 18px;
    line-height: 1.85;
    color: var(--muted);
    font-size: 14px;
  }
  .cgu-section strong {
    display: block;
    color: var(--gold);
    font-size: 15px;
    margin-bottom: 5px;
  }

  /* ================================================
     TOAST NOTIFICATION
  ================================================ */
  #toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--card2);
    border: 1px solid #444;
    border-radius: 12px;
    padding: 12px 20px;
    font-size: 13px;
    font-weight: 700;
    color: var(--text);
    z-index: 9999;
    transition: transform .3s ease;
    white-space: nowrap;
    box-shadow: 0 4px 20px rgba(0,0,0,.5);
  }
  #toast.show { transform: translateX(-50%) translateY(0); }
  #toast.gold { border-color: var(--gold); color: var(--gold); }
  #toast.err  { border-color: var(--red);  color: var(--red);  }

  /* Scrollbar */
  ::-webkit-scrollbar       { width: 4px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
  </style>
</head>
<body>

<!-- ================================================
     TOAST (notification discr√®te)
================================================ -->
<div id="toast"></div>

<!-- ================================================
     PAGE : CHARGEMENT
================================================ -->
<div id="page-loading" class="page">
  <div class="spinner"></div>
  <div class="loading-text">Connexion en cours...</div>
</div>

<!-- ================================================
     PAGE : CONNEXION
================================================ -->
<div id="page-login" class="page hidden">

  <div class="logo-text">REWARD WEB</div>
  <p class="subtitle">
    Rewards financ√©es par des pubs ¬∑
    plus vous regardez des pubs,<br>plus vous gagnez des r√©compenses
  </p>

  <button class="google-btn" onclick="connexionGoogle()">
    <img src="https://www.google.com/favicon.ico" alt="Google" />
    Continuer avec Google
  </button>

  <p class="login-note">
    üîí Ta progression est sauvegard√©e dans le cloud et li√©e √† ton compte Google.
  </p>

</div><!-- /page-login -->


<!-- ================================================
     PAGE : DASHBOARD
================================================ -->
<div id="page-dashboard" class="page hidden">

  <div class="top-bar">
    <h1>üéÆ REWARD WEB</h1>
    <button class="btn btn-dark"
            style="width:auto; padding:10px 16px; font-size:13px;"
            onclick="deconnecter()">
      D√©connexion
    </button>
  </div>

  <!-- Infos utilisateur Google -->
  <div class="user-info">
    <img id="user-avatar" class="user-avatar hidden" src="" alt="avatar" />
    <div id="user-avatar-placeholder" class="user-avatar-placeholder">?</div>
    <div class="user-details">
      <div class="user-name"  id="user-name">Joueur</div>
      <div class="user-email" id="user-email">...</div>
    </div>
    <span class="sync-badge">‚òÅÔ∏è Sync</span>
  </div>

  <!-- Compteur gold -->
  <div class="gold-counter" id="gold-display">
    <svg width="54" height="54" viewBox="0 0 54 54"
         style="flex-shrink:0" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="cg" cx="38%" cy="30%" r="62%">
          <stop offset="0%"   stop-color="#fff9a0"/>
          <stop offset="40%"  stop-color="#ffd700"/>
          <stop offset="80%"  stop-color="#ff9800"/>
          <stop offset="100%" stop-color="#b8730a"/>
        </radialGradient>
        <filter id="cs">
          <feDropShadow dx="0" dy="4" stdDeviation="3"
                        flood-color="#b8730a" flood-opacity=".55"/>
        </filter>
      </defs>
      <ellipse cx="27" cy="50" rx="18" ry="4" fill="rgba(0,0,0,.4)"/>
      <ellipse cx="27" cy="31" rx="20" ry="20" fill="#7a4900"/>
      <ellipse cx="27" cy="28" rx="20" ry="20" fill="url(#cg)" filter="url(#cs)"/>
      <ellipse cx="27" cy="28" rx="20" ry="20"
               fill="none" stroke="#ffe566" stroke-width="1.5" opacity=".7"/>
      <text x="27" y="35" text-anchor="middle" font-size="21" font-weight="900"
            font-family="Georgia,serif" fill="#b8730a" opacity=".4" dx="1" dy="1">G</text>
      <text x="27" y="35" text-anchor="middle" font-size="21" font-weight="900"
            font-family="Georgia,serif" fill="#fff8dc">G</text>
    </svg>
    <div>
      <div class="amount" id="gold-count">0</div>
      <div class="label">gold disponible</div>
    </div>
  </div>

  <!-- Sondage -->
  <div class="survey-msg blink">
    ‚ö†Ô∏è SONDAGE √Ä VENIR pour d√©cider de la prochaine r√©compense<br>
    ‚Äî PARTAGEZ MASSIVEMENT !
  </div>

  <!-- Pub -->
  <div class="card">
    <div class="section-title">üí∞ Gagner du gold</div>
    <button class="btn btn-gold" id="btn-pub" onclick="regarderPub()">
      üì∫ Regarder pub (+20 gold)
    </button>
  </div>

  <!-- Jeux -->
  <div class="card">
    <div class="section-title">üéÆ Mini-jeux (+5 gold par minute jou√©e)</div>
    <div class="games-grid">
      <button class="btn-game" onclick="lancerJeu('pong')">
        <span class="icon">üèì</span>Pong
      </button>
      <button class="btn-game" onclick="lancerJeu('snake')">
        <span class="icon">üêç</span>Snake
      </button>
    </div>
  </div>

  <!-- Navigation -->
  <div class="nav-grid">
    <button class="btn btn-dark" onclick="afficherPage('page-rewards')">üéÅ R√©compenses</button>
    <button class="btn btn-dark" onclick="afficherPage('page-cgu')">üìÑ CGU</button>
  </div>

</div><!-- /page-dashboard -->


<!-- ================================================
     PAGE : JEU
================================================ -->
<div id="page-game" class="page hidden">

  <button class="back-btn" onclick="quitterJeu()">‚Üê Retour</button>
  <h2 id="game-title">Jeu</h2>
  <div class="game-info" id="game-info">...</div>

  <canvas id="game-canvas" width="320" height="288"></canvas>

  <!-- Barre progression +5 gold -->
  <div class="gold-timer">
    <span id="timer-label">‚è± +5 gold dans <span id="timer-secs">60</span>s</span>
    <div class="timer-track">
      <div class="timer-fill" id="timer-fill"></div>
    </div>
  </div>

  <!-- Contr√¥les Pong -->
  <div id="pong-controls" class="pong-controls hidden">
    <button ontouchstart="pongDir=-1; event.preventDefault()"
            ontouchend="pongDir=0"
            onmousedown="pongDir=-1"
            onmouseup="pongDir=0">‚ñ≤</button>
    <button ontouchstart="pongDir=1; event.preventDefault()"
            ontouchend="pongDir=0"
            onmousedown="pongDir=1"
            onmouseup="pongDir=0">‚ñº</button>
  </div>

  <!-- D-Pad Snake -->
  <div id="snake-controls" class="snake-dpad hidden">
    <button class="dpad-up"
            ontouchstart="setSnakeDir(0,-1); event.preventDefault()"
            onmousedown="setSnakeDir(0,-1)">‚ñ≤</button>
    <button class="dpad-left"
            ontouchstart="setSnakeDir(-1,0); event.preventDefault()"
            onmousedown="setSnakeDir(-1,0)">‚óÄ</button>
    <button class="dpad-right"
            ontouchstart="setSnakeDir(1,0); event.preventDefault()"
            onmousedown="setSnakeDir(1,0)">‚ñ∂</button>
    <button class="dpad-down"
            ontouchstart="setSnakeDir(0,1); event.preventDefault()"
            onmousedown="setSnakeDir(0,1)">‚ñº</button>
  </div>

</div><!-- /page-game -->


<!-- ================================================
     PAGE : R√âCOMPENSES
================================================ -->
<div id="page-rewards" class="page hidden">

  <button class="back-btn" onclick="afficherPage('page-dashboard')">‚Üê Retour</button>
  <h2>üéÅ R√©compenses</h2>

  <div class="reward-card">
    <div class="reward-price">5 000 gold = 800 Robux</div>
    <img src="https://placehold.co/180x112/cc0000/ffffff?text=Roblox+Gift+Card"
         alt="Carte Roblox"
         onerror="this.style.display='none'" />
    <div class="reward-window-box">
      üìÖ <strong>Fen√™tre de retrait mensuelle :</strong>
      les retraits ne sont accept√©s que pendant la <strong>semaine exclusive</strong>
      d√©sign√©e chaque mois. Un seul retrait par personne et par mois est autoris√©.
      Suivez nos r√©seaux sociaux pour conna√Ætre les dates.
    </div>
    <p style="font-size:13px; color:var(--muted); margin-top:4px;">
      Ton solde : <strong id="rewards-gold" style="color:var(--gold)">0</strong> gold
    </p>
    <button class="btn btn-green" style="margin-top:14px;" onclick="retirerRecompense()">
      Retirer 800 Robux
    </button>
    <div id="reward-msg" class="reward-msg hidden"></div>
  </div>

</div><!-- /page-rewards -->


<!-- ================================================
     PAGE : CGU
================================================ -->
<div id="page-cgu" class="page hidden">

  <button class="back-btn" onclick="afficherPage('page-dashboard')">‚Üê Retour</button>
  <h2>üìÑ CGU</h2>

  <div class="card">
    <div class="cgu-section">
      <strong>1. Fonctionnement du service</strong>
      Les rewards sont financ√©es par des publicit√©s. Plus vous regardez des pubs,
      plus vous gagnez des r√©compenses. Le gold est √©galement gagn√© en jouant aux
      mini-jeux (+5 gold par minute jou√©e) ou via les bonus promotionnels.
    </div>
    <div class="cgu-section">
      <strong>2. Nature du gold</strong>
      Le gold accumul√© est strictement virtuel et ne poss√®de aucune valeur mon√©taire r√©elle.
      Il ne peut √™tre √©chang√© que contre les r√©compenses disponibles sur la plateforme.
    </div>
    <div class="cgu-section">
      <strong>3. Fen√™tre de retrait mensuelle exclusive</strong>
      Les retraits ne sont autoris√©s que durant la
      <strong>semaine exclusive d√©sign√©e chaque mois</strong> par REWARD WEB.
      Chaque utilisateur ne peut effectuer <strong>qu'un seul retrait par mois</strong>.
      Les dates sont communiqu√©es via nos r√©seaux sociaux.
    </div>
    <div class="cgu-section">
      <strong>4. Traitement des retraits</strong>
      Les retraits approuv√©s sont trait√©s sous 24 h √† 48 h.
      REWARD WEB peut suspendre un retrait en cas de fraude ou d'abus.
    </div>
    <div class="cgu-section">
      <strong>5. Conditions d'utilisation</strong>
      En utilisant REWARD WEB, vous confirmez avoir plus de 13 ans et acceptez
      l'ensemble des pr√©sentes conditions.
    </div>
    <div class="cgu-section">
      <strong>6. Limitation de responsabilit√©</strong>
      La progression est sauvegard√©e dans le cloud via Firebase.
      REWARD WEB ne peut √™tre tenu responsable d'une perte de donn√©es
      li√©e √† un probl√®me externe.
    </div>
    <em style="color:var(--muted); font-size:12px;">Version 2.0 ‚Äî 2025</em>
  </div>

</div><!-- /page-cgu -->


<!-- ================================================
     FIREBASE SDK (CDN - pas de npm n√©cessaire)
================================================ -->
<script type="module">
"use strict";

/* ================================================
   IMPORT FIREBASE
================================================ */
import { initializeApp }
  from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getAuth,
  GoogleAuthProvider,
  signInWithPopup,
  signOut,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import {
  getFirestore,
  doc,
  getDoc,
  setDoc,
  updateDoc,
  onSnapshot,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ================================================
   CONFIG FIREBASE ‚Äî Reward-Web
================================================ */
const firebaseConfig = {
  apiKey:            "AIzaSyCAHQoJWJbixkdiMELM3NBCURafBl_ez4Q",
  authDomain:        "reward-web-ba140.firebaseapp.com",
  projectId:         "reward-web-ba140",
  storageBucket:     "reward-web-ba140.firebasestorage.app",
  messagingSenderId: "1057879174996",
  appId:             "1:1057879174996:web:de0b247f1b91ac4c0922c1"
};

/* ================================================
   INITIALISATION
================================================ */
const app  = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);

/* ================================================
   √âTAT GLOBAL
================================================ */
const PAGES = [
  'page-loading',
  'page-login',
  'page-dashboard',
  'page-game',
  'page-rewards',
  'page-cgu'
];

let currentUser = null;  // utilisateur Firebase connect√©
let gold        = 0;     // gold en m√©moire

/* ================================================
   NAVIGATION
================================================ */
function afficherPage(id) {
  PAGES.forEach(p => document.getElementById(p).classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  if (id === 'page-rewards') majAffichageGold();
}
window.afficherPage = afficherPage;

/* ================================================
   TOAST NOTIFICATION
================================================ */
let toastTimer = null;

function showToast(msg, type = '') {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.className   = 'show ' + type;
  if (toastTimer) clearTimeout(toastTimer);
  toastTimer = setTimeout(() => { el.className = ''; }, 3000);
}

/* ================================================
   GOLD ‚Äî Firestore
================================================ */
function majAffichageGold() {
  const v = gold.toLocaleString('fr-FR');
  const el1 = document.getElementById('gold-count');
  const el2 = document.getElementById('rewards-gold');
  if (el1) el1.textContent = v;
  if (el2) el2.textContent = v;
}

function flashGold() {
  const el = document.getElementById('gold-display');
  if (!el) return;
  el.classList.remove('flash');
  void el.offsetWidth;
  el.classList.add('flash');
}

async function ajouterGold(montant) {
  gold = Math.max(0, gold + montant);
  majAffichageGold();
  if (montant > 0) flashGold();
  await sauvegarderGoldCloud();
}

async function sauvegarderGoldCloud() {
  if (!currentUser) return;
  try {
    const ref = doc(db, 'users', currentUser.uid);
    await updateDoc(ref, {
      gold:        gold,
      lastUpdated: serverTimestamp()
    });
  } catch (e) {
    console.warn('Erreur sauvegarde gold :', e);
  }
}

/* Listener Firestore temps r√©el ‚Äî s'arr√™te quand on se d√©connecte */
let unsubscribeSnapshot = null;

async function chargerGoldCloud() {
  if (!currentUser) return;

  const ref = doc(db, 'users', currentUser.uid);

  // V√©rifier si le document existe, sinon le cr√©er
  try {
    const snap = await getDoc(ref);
    if (!snap.exists()) {
      await setDoc(ref, {
        uid:         currentUser.uid,
        email:       currentUser.email,
        displayName: currentUser.displayName,
        gold:        0,
        createdAt:   serverTimestamp(),
        lastUpdated: serverTimestamp()
      });
    }
  } catch (e) {
    console.warn('Erreur init document :', e);
  }

  // √âcouter les changements en temps r√©el
  // ‚Üí le gold ne retombera JAMAIS √† 0 au rechargement
  unsubscribeSnapshot = onSnapshot(ref, (snap) => {
    if (snap.exists()) {
      const data = snap.data();
      gold = data.gold || 0;
      majAffichageGold();
    }
  }, (e) => {
    console.warn('Erreur snapshot :', e);
  });
}

/* ================================================
   AUTHENTIFICATION GOOGLE
================================================ */
async function connexionGoogle() {
  const provider = new GoogleAuthProvider();
  try {
    await signInWithPopup(auth, provider);
    // onAuthStateChanged g√®re la suite automatiquement
  } catch (e) {
    console.error('Erreur connexion :', e);
    showToast('‚ùå Connexion annul√©e', 'err');
  }
}
window.connexionGoogle = connexionGoogle;

async function deconnecter() {
  if (!confirm('D√©connexion ?\nTon gold est sauvegard√© dans le cloud.')) return;
  stopToutJeu();
  // Arr√™ter l'√©coute Firestore
  if (unsubscribeSnapshot) { unsubscribeSnapshot(); unsubscribeSnapshot = null; }
  await signOut(auth);
}
window.deconnecter = deconnecter;

/* Surveille l'√©tat de connexion en temps r√©el */
onAuthStateChanged(auth, async (user) => {
  if (user) {
    currentUser = user;

    // Remplir les infos utilisateur
    document.getElementById('user-name').textContent  = user.displayName || 'Joueur';
    document.getElementById('user-email').textContent = user.email || '';

    // Avatar
    if (user.photoURL) {
      const av = document.getElementById('user-avatar');
      const ph = document.getElementById('user-avatar-placeholder');
      av.src = user.photoURL;
      av.classList.remove('hidden');
      ph.classList.add('hidden');
    } else {
      const initiale = (user.displayName || 'J')[0].toUpperCase();
      document.getElementById('user-avatar-placeholder').textContent = initiale;
    }

    // Charger le gold depuis Firestore (onSnapshot)
    // On attend le PREMIER snapshot avant d'afficher le dashboard
    // pour √©viter d'afficher gold=0 pendant une fraction de seconde
    await new Promise((resolve) => {
      const ref = doc(db, 'users', currentUser.uid);

      // Init document si premi√®re connexion
      getDoc(ref).then(async (snap) => {
        if (!snap.exists()) {
          await setDoc(ref, {
            uid:         user.uid,
            email:       user.email,
            displayName: user.displayName,
            gold:        0,
            createdAt:   serverTimestamp(),
            lastUpdated: serverTimestamp()
          });
        }

        // √âcoute temps r√©el ‚Äî premier appel r√©sout la Promise
        let premierAppel = true;
        unsubscribeSnapshot = onSnapshot(ref, (s) => {
          if (s.exists()) {
            gold = s.data().gold || 0;
            majAffichageGold();
          }
          if (premierAppel) { premierAppel = false; resolve(); }
        }, (e) => {
          console.warn('Erreur snapshot :', e);
          resolve(); // on affiche quand m√™me le dashboard
        });

      }).catch((e) => {
        console.warn('Erreur getDoc init :', e);
        resolve();
      });
    });

    afficherPage('page-dashboard');

  } else {
    currentUser = null;
    gold        = 0;
    if (unsubscribeSnapshot) { unsubscribeSnapshot(); unsubscribeSnapshot = null; }
    afficherPage('page-login');
  }
});

/* ================================================
   PUB SIMUL√âE
================================================ */
let pubEnCours = false;

async function regarderPub() {
  if (pubEnCours) return;
  pubEnCours = true;
  const btn = document.getElementById('btn-pub');
  btn.disabled    = true;
  btn.textContent = '‚è≥ Pub en cours... (2s)';

  setTimeout(async () => {
    await ajouterGold(20);
    btn.disabled    = false;
    btn.textContent = 'üì∫ Regarder pub (+20 gold)';
    pubEnCours      = false;
    showToast('‚úÖ +20 gold ! Pub termin√©e.', 'gold');
  }, 2000);
}
window.regarderPub = regarderPub;

/* ================================================
   TIMER JEU ‚Äî +5 gold par minute cons√©cutive
================================================ */
let jeuActif      = false;
let timerSecondes = 0;
let timerInterval = null;

function demarrerTimerJeu() {
  timerSecondes = 0;
  _majBarreTimer();
  if (timerInterval) clearInterval(timerInterval);

  timerInterval = setInterval(async () => {
    if (!jeuActif) return;
    timerSecondes++;
    _majBarreTimer();

    if (timerSecondes >= 60) {
      timerSecondes = 0;
      await ajouterGold(5);
      showToast('‚è± +5 gold pour 1 minute de jeu !', 'gold');
      _majBarreTimer();
    }
  }, 1000);
}

function stopTimerJeu() {
  clearInterval(timerInterval);
  timerInterval = null;
  timerSecondes = 0;
  _majBarreTimer();
}

function _majBarreTimer() {
  const fill  = document.getElementById('timer-fill');
  const label = document.getElementById('timer-secs');
  if (fill)  fill.style.width = (timerSecondes / 60 * 100) + '%';
  if (label) label.textContent = 60 - timerSecondes;
}

/* ================================================
   GESTION DES JEUX
================================================ */
let jeuActuel  = null;
let pongRAF    = null;
let snakeTimer = null;

function lancerJeu(type) {
  stopToutJeu();
  jeuActuel = type;
  jeuActif  = true;
  afficherPage('page-game');

  document.getElementById('pong-controls').classList.add('hidden');
  document.getElementById('snake-controls').classList.add('hidden');

  if (type === 'pong') {
    document.getElementById('game-title').textContent = 'üèì Pong';
    document.getElementById('game-info').textContent  =
      '‚ñ≤‚ñº clavier ou boutons ¬∑ si la balle d√©passe ta raquette ‚Üí game over';
    document.getElementById('pong-controls').classList.remove('hidden');
    initPong();
  } else {
    document.getElementById('game-title').textContent = 'üêç Snake';
    document.getElementById('game-info').textContent  =
      'D-Pad ou fl√®ches clavier ¬∑ √©vite les murs et toi-m√™me';
    document.getElementById('snake-controls').classList.remove('hidden');
    initSnake();
  }

  demarrerTimerJeu();
}
window.lancerJeu = lancerJeu;

function quitterJeu() {
  stopToutJeu();
  afficherPage('page-dashboard');
}
window.quitterJeu = quitterJeu;

function stopToutJeu() {
  jeuActif = false;
  stopTimerJeu();
  if (pongRAF)    { cancelAnimationFrame(pongRAF); pongRAF = null; }
  if (snakeTimer) { clearInterval(snakeTimer);     snakeTimer = null; }
  document.onkeydown = null;
  document.onkeyup   = null;
}

/* ================================================
   PONG
   - Raquette joueur √† droite
   - Si la balle d√©passe le joueur ‚Üí game over
   - Aucun gold li√© au Pong (uniquement le timer 60s)
================================================ */
let pongDir = 0;

function initPong() {
  const canvas = document.getElementById('game-canvas');
  const ctx    = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;
  const PH = 60, PW = 12;

  let bx = W/2, by = H/2, vx = 4.5, vy = 3;
  let py = H/2 - PH/2;
  let iy = H/2 - PH/2;
  let goEnCours = false;
  pongDir = 0;

  document.onkeydown = (e) => {
    if (e.key === 'ArrowUp')   { pongDir = -1; e.preventDefault(); }
    if (e.key === 'ArrowDown') { pongDir =  1; e.preventDefault(); }
  };
  document.onkeyup = (e) => {
    if (e.key === 'ArrowUp' || e.key === 'ArrowDown') pongDir = 0;
  };

  function resetBalle() {
    bx = W/2; by = H/2;
    vx = (Math.random() > .5 ? 1 : -1) * 4.5;
    vy = (Math.random() > .5 ? 1 : -1) * 3.0;
  }

  function gameOverPong() {
    if (goEnCours) return;
    goEnCours = true;
    jeuActif  = false;
    stopTimerJeu();
    cancelAnimationFrame(pongRAF); pongRAF = null;

    setTimeout(() => {
      const rejouer = confirm('üí• Game Over !\nLa balle a d√©pass√© ta raquette.\n\nRejouer ?');
      if (rejouer) lancerJeu('pong');
      else         quitterJeu();
    }, 60);
  }

  function loop() {
    if (!jeuActif || jeuActuel !== 'pong' || goEnCours) return;

    py = Math.max(0, Math.min(H - PH, py + pongDir * 5));

    const mid = iy + PH / 2;
    if (mid < by - 3) iy = Math.min(H - PH, iy + 3.2);
    if (mid > by + 3) iy = Math.max(0,       iy - 3.2);

    bx += vx; by += vy;

    if (by <= 6)     { by = 6;     vy =  Math.abs(vy); }
    if (by >= H - 6) { by = H - 6; vy = -Math.abs(vy); }

    // Raquette joueur (droite)
    if (vx > 0 && bx >= W - PW - 14 && by >= py && by <= py + PH) {
      vx = -(Math.abs(vx) + 0.2);
      vy += (Math.random() - .5) * 1.5;
      bx  = W - PW - 15;
    }
    // Raquette IA (gauche)
    if (vx < 0 && bx <= PW + 14 && by >= iy && by <= iy + PH) {
      vx = Math.abs(vx) + 0.15;
      bx = PW + 15;
    }

    if (bx < 0) { resetBalle(); }   // IA rate ‚Üí reset
    if (bx > W) { gameOverPong(); return; } // joueur rate ‚Üí game over

    // Rendu
    ctx.fillStyle = '#111';
    ctx.fillRect(0, 0, W, H);

    ctx.save();
    ctx.setLineDash([6, 8]);
    ctx.strokeStyle = '#2a2a2a'; ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(W/2, 0); ctx.lineTo(W/2, H); ctx.stroke();
    ctx.restore();

    ctx.fillStyle = '#ffd700';
    ctx.beginPath(); ctx.roundRect(W - PW - 10, py, PW, PH, 4); ctx.fill();

    ctx.fillStyle = '#e74c3c';
    ctx.beginPath(); ctx.roundRect(10, iy, PW, PH, 4); ctx.fill();

    ctx.fillStyle = '#ffffff';
    ctx.beginPath(); ctx.arc(bx, by, 8, 0, Math.PI * 2); ctx.fill();

    pongRAF = requestAnimationFrame(loop);
  }

  resetBalle();
  pongRAF = requestAnimationFrame(loop);
}

/* ================================================
   SNAKE
   - snakeCurrDir / snakeNextDir : globales
   - 0 gold √† la mort
   - Seul le timer 60s donne du gold
================================================ */
let snakeCurrDir = { x: 1, y: 0 };
let snakeNextDir = { x: 1, y: 0 };

function setSnakeDir(dx, dy) {
  if (dx !== 0 && snakeCurrDir.x !== 0) return;
  if (dy !== 0 && snakeCurrDir.y !== 0) return;
  snakeNextDir = { x: dx, y: dy };
}
window.setSnakeDir = setSnakeDir;

function initSnake() {
  const canvas = document.getElementById('game-canvas');
  const ctx    = canvas.getContext('2d');
  const COLS = 20, ROWS = 18;
  const TW = Math.floor(canvas.width / COLS);
  const TH = Math.floor(canvas.height / ROWS);

  snakeCurrDir = { x: 1, y: 0 };
  snakeNextDir = { x: 1, y: 0 };

  let serpent    = [{ x: 5, y: 9 }, { x: 4, y: 9 }, { x: 3, y: 9 }];
  let nourriture = nouvNourriture();
  let score      = 0;
  let goEnCours  = false;

  function nouvNourriture() {
    let f;
    do {
      f = {
        x: Math.floor(Math.random() * COLS),
        y: Math.floor(Math.random() * ROWS)
      };
    } while (serpent.some(s => s.x === f.x && s.y === f.y));
    return f;
  }

  document.onkeydown = (e) => {
    switch (e.key) {
      case 'ArrowUp':    setSnakeDir( 0, -1); e.preventDefault(); break;
      case 'ArrowDown':  setSnakeDir( 0,  1); e.preventDefault(); break;
      case 'ArrowLeft':  setSnakeDir(-1,  0); e.preventDefault(); break;
      case 'ArrowRight': setSnakeDir( 1,  0); e.preventDefault(); break;
    }
  };

  function render() {
    ctx.fillStyle = '#111';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.strokeStyle = '#1c1c1c'; ctx.lineWidth = 0.5;
    for (let c = 0; c < COLS; c++) {
      ctx.beginPath();
      ctx.moveTo(c * TW, 0); ctx.lineTo(c * TW, canvas.height); ctx.stroke();
    }
    for (let r = 0; r < ROWS; r++) {
      ctx.beginPath();
      ctx.moveTo(0, r * TH); ctx.lineTo(canvas.width, r * TH); ctx.stroke();
    }

    ctx.fillStyle = '#e74c3c';
    ctx.beginPath();
    ctx.arc(
      nourriture.x * TW + TW / 2,
      nourriture.y * TH + TH / 2,
      TW / 2 - 1, 0, Math.PI * 2
    );
    ctx.fill();

    serpent.forEach((seg, i) => {
      ctx.fillStyle = i === 0 ? '#2ecc71'
                    : (i % 2 === 0 ? '#27ae60' : '#229954');
      ctx.beginPath();
      ctx.roundRect(seg.x * TW + 1, seg.y * TH + 1, TW - 2, TH - 2, 3);
      ctx.fill();
    });

    ctx.fillStyle = 'rgba(255,215,0,.85)';
    ctx.font      = 'bold 13px Segoe UI, Arial';
    ctx.fillText('Score : ' + score, 8, 18);
  }

  function step() {
    if (!jeuActif || jeuActuel !== 'snake' || goEnCours) return;

    snakeCurrDir = { ...snakeNextDir };
    const tete = {
      x: serpent[0].x + snakeCurrDir.x,
      y: serpent[0].y + snakeCurrDir.y
    };

    if (tete.x < 0 || tete.x >= COLS || tete.y < 0 || tete.y >= ROWS) {
      gameOverSnake(); return;
    }
    if (serpent.slice(0, -1).some(s => s.x === tete.x && s.y === tete.y)) {
      gameOverSnake(); return;
    }

    serpent.unshift(tete);

    if (tete.x === nourriture.x && tete.y === nourriture.y) {
      score++;
      nourriture = nouvNourriture();
      // Pas de gold ici ‚Äî uniquement le timer 60s
    } else {
      serpent.pop();
    }

    render();
  }

  function gameOverSnake() {
    goEnCours = true;
    clearInterval(snakeTimer); snakeTimer = null;
    jeuActif = false;
    stopTimerJeu(); // compteur remis √† 0, pas de gold partiel

    setTimeout(() => {
      const rejouer = confirm(
        'üíÄ Game Over !\nScore : ' + score +
        '\n(Aucun gold pour une partie perdue)\n\nRejouer ?'
      );
      if (rejouer) lancerJeu('snake');
      else         quitterJeu();
    }, 80);
  }

  render();
  if (snakeTimer) clearInterval(snakeTimer);
  snakeTimer = setInterval(step, 130);
}

/* ================================================
   R√âCOMPENSES
================================================ */
async function retirerRecompense() {
  const msg = document.getElementById('reward-msg');
  msg.classList.remove('hidden', 'ok', 'err');

  if (gold < 5000) {
    msg.classList.add('err');
    msg.textContent =
      '‚ùå Gold insuffisant ! Il te faut 5 000 gold'
      + ' (tu en as ' + gold.toLocaleString('fr-FR') + ').';
  } else {
    await ajouterGold(-5000);
    msg.classList.add('ok');
    msg.textContent =
      '‚úÖ Retrait demand√© ! Tu recevras tes Robux'
      + ' durant la fen√™tre mensuelle (24‚Äì48 h).';
  }

  setTimeout(() => msg.classList.add('hidden'), 5000);
}
window.retirerRecompense = retirerRecompense;

</script>
</body>
</html>
