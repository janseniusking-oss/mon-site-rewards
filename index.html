<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reward Web</title>
  <!-- Ton CSS est probablement ici, mais il n'√©tait pas dans le fragment partag√© -->
  <style>
    /* Si tu as le CSS original, colle-le ici. Sinon, c'est probablement dans un <style> pr√©c√©dent */
    .hidden { display: none; }
    .flash { animation: flash 0.6s; }
    @keyframes flash { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    /* ... le reste de ton style ... */
  </style>
</head>
<body>

<!-- Les pages HTML √©taient probablement avant le fragment que tu as coll√© -->
<!-- Exemple approximatif des divs manquants (√† adapter avec ton vrai HTML) -->
<div id="page-login">‚Ä¶ Contenu login ‚Ä¶</div>
<div id="page-dashboard">
  <span id="user-name"></span>
  <span id="gold-count">0</span>
  <button id="btn-pub">üì∫ Regarder pub (+20 gold)</button>
  <!-- boutons pour lancerJeu('pong'), lancerJeu('snake'), etc. -->
</div>
<div id="page-game">
  <h2 id="game-title"></h2>
  <p id="game-info"></p>
  <canvas id="game-canvas" width="400" height="300"></canvas>
  <div id="pong-controls" class="hidden">‚Ä¶ boutons ‚Üë ‚Üì ‚Ä¶</div>
  <div id="snake-controls" class="hidden">‚Ä¶ boutons ‚Üê ‚Üë ‚Üí ‚Üì ‚Ä¶</div>
</div>
<div id="page-rewards">
  <span id="rewards-gold">0</span>
  <div id="reward-msg" class="reward-msg"></div>
  <!-- bouton pour retirerRecompense() -->
</div>
<div id="page-cgu">
  <div>
    <p>Rewards financ√©es par des pubs ¬∑ plus vous regardez des pubs plus vous gagnez des r√©compenses.<br/><br/>
      Le gold accumul√© est strictement virtuel et n'a aucune valeur mon√©taire. Les r√©compenses (Robux)
      sont soumises √† disponibilit√© et peuvent n√©cessiter un d√©lai de traitement de 24 h √† 48 h.<br/><br/>
      En utilisant REWARD WEB, vous acceptez ces conditions et confirmez avoir plus de 13 ans.
      REWARD WEB se r√©serve le droit de modifier ces CGU √† tout moment.<br/><br/>
      <em style="color:var(--muted);">Version 1.0 ‚Äî 2025</em>
    </p>
  </div>
</div>

<!-- =====================================================
     SCRIPT PRINCIPAL (exactement comme tu l'as envoy√©)
===================================================== -->
<script>
  /* ================================================
     GESTION GOLD (localStorage)
  ================================================ */
  let gold = parseInt(localStorage.getItem('gold') || '0');
  function sauvegarderGold() {
    localStorage.setItem('gold', gold);
  }
  function mettreAJourAffichageGold() {
    const el = document.getElementById('gold-count');
    if (el) el.textContent = gold;
    const elR = document.getElementById('rewards-gold');
    if (elR) elR.textContent = gold;
  }
  function ajouterGold(montant, sourceId = 'gold-display') {
    gold += montant;
    sauvegarderGold();
    mettreAJourAffichageGold();
    // Flash animation
    const el = document.getElementById(sourceId);
    if (el) {
      el.classList.remove('flash');
      void el.offsetWidth; // reflow pour relancer l'animation
      el.classList.add('flash');
    }
  }
  /* ================================================
     NAVIGATION
  ================================================ */
  const PAGES = ['page-login','page-dashboard','page-game','page-rewards','page-cgu'];
  function afficherPage(id) {
    PAGES.forEach(p => document.getElementById(p).classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
    if (id === 'page-rewards') mettreAJourAffichageGold();
  }
  /* ================================================
     CONNEXION / D√âCONNEXION
  ================================================ */
  function simulerConnexion(provider) {
    // Simulation : on stocke l'√©tat dans localStorage
    localStorage.setItem('connected', 'true');
    localStorage.setItem('provider', provider);
    localStorage.setItem('userName', provider + ' User');
    chargerDashboard();
  }
  function chargerDashboard() {
    const name = localStorage.getItem('userName') || 'Joueur';
    document.getElementById('user-name').textContent = name;
    mettreAJourAffichageGold();
    afficherPage('page-dashboard');
    demarrerGainJeu(); // s'assure que le timer est pr√™t
  }
  function deconnecter() {
    if (!confirm('D√©connexion ? Ton gold est sauvegard√©.')) return;
    localStorage.removeItem('connected');
    localStorage.removeItem('provider');
    localStorage.removeItem('userName');
    location.reload();
  }
  /* ================================================
     SIMULATION PUB
  ================================================ */
  let pubEnCours = false;
  function regarderPub() {
    if (pubEnCours) return;
    pubEnCours = true;
    const btn = document.getElementById('btn-pub');
    btn.disabled = true;
    btn.textContent = '‚è≥ Pub en cours... (2s)';
    setTimeout(() => {
      ajouterGold(20);
      btn.disabled = false;
      btn.textContent = 'üì∫ Regarder pub (+20 gold)';
      pubEnCours = false;
      alert('‚úÖ Pub termin√©e ! +20 gold ajout√©s.');
    }, 2000);
  }
  /* ================================================
     GOLD PAR JEU (5 gold/min max)
  ================================================ */
  let jeuActif = false;
  let jeuGoldInterval = null;
  let jeuGoldCeMinute = 0;
  let jeuMinuteInterval = null;
  function demarrerGainJeu() {
    // Reset par minute
    if (jeuMinuteInterval) clearInterval(jeuMinuteInterval);
    jeuMinuteInterval = setInterval(() => { jeuGoldCeMinute = 0; }, 60000);
  }
  function activerGoldJeu() {
    if (jeuGoldInterval) return;
    jeuGoldInterval = setInterval(() => {
      if (!jeuActif) return;
      if (jeuGoldCeMinute < 5) {
        jeuGoldCeMinute++;
        ajouterGold(1, 'gold-display');
      }
    }, 12000); // 5 gains r√©partis sur 60s ‚Üí toutes les 12s
  }
  function desactiverGoldJeu() {
    clearInterval(jeuGoldInterval);
    jeuGoldInterval = null;
  }
  /* ================================================
     LANCER / QUITTER JEU
  ================================================ */
  let jeuActuel = null;
  let pongRAF = null;
  let snakeInterval = null;
  function lancerJeu(type) {
    jeuActuel = type;
    jeuActif = true;
    afficherPage('page-game');
    document.getElementById('pong-controls').classList.add('hidden');
    document.getElementById('snake-controls').classList.add('hidden');
    if (type === 'pong') {
      document.getElementById('game-title').textContent = 'üèì Pong';
      document.getElementById('game-info').textContent = 'Fl√®ches ‚Üë‚Üì ou boutons tactiles ¬∑ +50 gold si balle sort √† droite';
      document.getElementById('pong-controls').classList.remove('hidden');
      lancerPong();
    } else {
      document.getElementById('game-title').textContent = 'üêç Snake';
      document.getElementById('game-info').textContent = 'Fl√®ches directionnelles ou boutons ¬∑ +50 gold par partie';
      document.getElementById('snake-controls').classList.remove('hidden');
      lancerSnake();
    }
    activerGoldJeu();
  }
  function quitterJeu() {
    jeuActif = false;
    desactiverGoldJeu();
    if (pongRAF) { cancelAnimationFrame(pongRAF); pongRAF = null; }
    if (snakeInterval) { clearInterval(snakeInterval); snakeInterval = null; }
    afficherPage('page-dashboard');
  }
  /* ================================================
     PONG
  ================================================ */
  let pongDir = 0; // -1 haut, 0 stop, 1 bas
  function lancerPong() {
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;
    // √âtat
    let bx = W/2, by = H/2;
    let vx = 4, vy = 3;
    let py = H/2 - 30; // raquette joueur (droite)
    const PH = 60, PW = 10;
    // Raquette IA (gauche)
    let iy = H/2 - 30;
    function resetBalle() {
      bx = W/2; by = H/2;
      vx = (Math.random() > .5 ? 1 : -1) * 4;
      vy = (Math.random() > .5 ? 1 : -1) * 3;
    }
    function loop() {
      // Clavier
      if (pongDir !== 0) {
        py = Math.max(0, Math.min(H - PH, py + pongDir * 5));
      }
      // IA simple
      if (iy + PH/2 < by) iy = Math.min(H - PH, iy + 3);
      if (iy + PH/2 > by) iy = Math.max(0, iy - 3);
      // Mouvement balle
      bx += vx; by += vy;
      // Mur haut/bas
      if (by <= 5 || by >= H - 5) vy = -vy;
      // Raquette droite (joueur)
      if (bx >= W - PW - 15 && by >= py && by <= py + PH) {
        vx = -Math.abs(vx) - .3;
        vy += (Math.random() - .5) * 1.5;
      }
      // Raquette gauche (IA)
      if (bx <= PW + 15 && by >= iy && by <= iy + PH) {
        vx = Math.abs(vx) + .2;
      }
      // Balle sort √† gauche ‚Üí point IA
      if (bx < 0) { resetBalle(); }
      // Balle sort √† droite ‚Üí +50 gold pour joueur
      if (bx > W) {
        ajouterGold(50);
        alert('üèÜ +50 gold ! La balle est pass√©e √† droite !');
        resetBalle();
      }
      // Rendu
      ctx.fillStyle = '#111';
      ctx.fillRect(0, 0, W, H);
      // Ligne centrale
      ctx.setLineDash([6,8]);
      ctx.strokeStyle = '#333';
      ctx.lineWidth = 2;
      ctx.beginPath(); ctx.moveTo(W/2, 0); ctx.lineTo(W/2, H); ctx.stroke();
      ctx.setLineDash([]);
      // Raquettes
      ctx.fillStyle = '#ffd700';
      ctx.fillRect(W - PW - 10, py, PW, PH);
      ctx.fillStyle = '#e74c3c';
      ctx.fillRect(10, iy, PW, PH);
      // Balle
      ctx.beginPath();
      ctx.arc(bx, by, 8, 0, Math.PI*2);
      ctx.fillStyle = '#fff';
      ctx.fill();
      if (jeuActif && jeuActuel === 'pong') pongRAF = requestAnimationFrame(loop);
    }
    resetBalle();
    pongRAF = requestAnimationFrame(loop);
    // Clavier
    document.onkeydown = e => {
      if (e.key === 'ArrowUp') pongDir = -1;
      if (e.key === 'ArrowDown') pongDir = 1;
    };
    document.onkeyup = e => {
      if (e.key === 'ArrowUp' || e.key === 'ArrowDown') pongDir = 0;
    };
  }
  /* ================================================
     SNAKE
  ================================================ */
  let snakeDir = {x:1, y:0};
  function lancerSnake() {
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    const COLS = 20, ROWS = 17;
    const TW = Math.floor(canvas.width / COLS);
    const TH = Math.floor(canvas.height / ROWS);
    let serpent = [{x:5,y:8},{x:4,y:8},{x:3,y:8}];
    snakeDir = {x:1, y:0};
    let nextDir = {x:1, y:0};
    let nourriture = placerNourriture();
    function placerNourriture() {
      let f;
      do {
        f = {x: Math.floor(Math.random()*COLS), y: Math.floor(Math.random()*ROWS)};
      } while (serpent.some(s => s.x===f.x && s.y===f.y));
      return f;
    }
    // Clavier
    document.onkeydown = e => {
      if (e.key==='ArrowUp' && snakeDir.y===0) nextDir={x:0,y:-1};
      if (e.key==='ArrowDown' && snakeDir.y===0) nextDir={x:0,y:1};
      if (e.key==='ArrowLeft' && snakeDir.x===0) nextDir={x:-1,y:0};
      if (e.key==='ArrowRight' && snakeDir.x===0) nextDir={x:1,y:0};
    };
    // Emp√™che direction oppos√©e via boutons tactiles
    const setDir = (d) => {
      if (d.x !== 0 && snakeDir.x !== 0) return;
      if (d.y !== 0 && snakeDir.y !== 0) return;
      nextDir = d;
    };
    // Override global snakeDir click pour Snake
    window._snakeSetDir = setDir;
    function step() {
      snakeDir = {...nextDir};
      const tete = {x: serpent[0].x + snakeDir.x, y: serpent[0].y + snakeDir.y};
      // Collision mur
      if (tete.x<0 || tete.x>=COLS || tete.y<0 || tete.y>=ROWS) {
        gameOver(); return;
      }
      // Collision soi-m√™me
      if (serpent.some(s => s.x===tete.x && s.y===tete.y)) {
        gameOver(); return;
      }
      serpent.unshift(tete);
      if (tete.x===nourriture.x && tete.y===nourriture.y) {
        nourriture = placerNourriture();
        // +50 gold toutes les 5 nourritures
        if (serpent.length % 5 === 0) {
          ajouterGold(50);
          alert('üêç +50 gold ! Continue comme √ßa !');
        }
      } else {
        serpent.pop();
      }
      render();
    }
    function gameOver() {
      clearInterval(snakeInterval);
      snakeInterval = null;
      ajouterGold(50);
      alert('üíÄ Game Over ! +50 gold pour la partie. Relancer ?');
      lancerSnake();
    }
    function render() {
      ctx.fillStyle = '#111';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      // Grille l√©g√®re
      ctx.strokeStyle = '#1a1a1a';
      ctx.lineWidth = .5;
      for (let c=0;c<COLS;c++) { ctx.beginPath(); ctx.moveTo(c*TW,0); ctx.lineTo(c*TW,canvas.height); ctx.stroke(); }
      for (let r=0;r<ROWS;r++) { ctx.beginPath(); ctx.moveTo(0,r*TH); ctx.lineTo(canvas.width,r*TH); ctx.stroke(); }
      // Nourriture
      ctx.fillStyle = '#e74c3c';
      ctx.beginPath();
      ctx.arc(nourriture.x*TW+TW/2, nourriture.y*TH+TH/2, TW/2-2, 0, Math.PI*2);
      ctx.fill();
      // Serpent
      serpent.forEach((seg,i) => {
        ctx.fillStyle = i===0 ? '#2ecc71' : '#27ae60';
        ctx.fillRect(seg.x*TW+1, seg.y*TH+1, TW-2, TH-2);
      });
    }
    render();
    if (snakeInterval) clearInterval(snakeInterval);
    snakeInterval = setInterval(step, 130);
  }
  /* ================================================
     R√âCOMPENSES
  ================================================ */
  function retirerRecompense() {
    const msg = document.getElementById('reward-msg');
    msg.style.display = 'block';
    if (gold < 5000) {
      msg.className = 'reward-msg err';
      msg.textContent = '‚ùå Gold insuffisant ! Il te faut 5 000 gold (tu en as ' + gold + ').';
    } else {
      ajouterGold(-5000);
      mettreAJourAffichageGold();
      msg.className = 'reward-msg ok';
      msg.textContent = '‚úÖ Retrait demand√© ! Tu recevras tes Robux sous 24 h.';
    }
    setTimeout(() => { msg.style.display = 'none'; }, 4000);
  }
  /* ================================================
     INIT AU CHARGEMENT
  ================================================ */
  (function init() {
    // V√©rifier si d√©j√† connect√©
    if (localStorage.getItem('connected') === 'true') {
      chargerDashboard();
    } else {
      afficherPage('page-login');
    }
    demarrerGainJeu();
  })();
</script>
</body>
</html>
